{% extends "base.html" %}

{% block content %}
<div class="dashboard-header">
    <div class="user-info">
        <h2>User Settings</h2>
        <p class="date-display">Manage your account and data</p>
    </div>
</div>

<div class="profile-section">
    <div class="profile-header">
        <div class="profile-avatar-large"
            style="position: relative; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1);">
            <img src="{{ url_for('static', filename='avatars/user_' ~ user.id ~ '.jpg') }}"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                style="width: 100%; height: 100%; object-fit: cover;">
            <div class="avatar-fallback" style="display: none; font-size: 3rem; color: var(--text-muted);">
                <i class="fas fa-user"></i>
            </div>
        </div>
        <div class="profile-info">
            <h2>{{ user.email }}</h2>
            <form action="{{ url_for('auth.profile') }}" method="post" enctype="multipart/form-data"
                class="upload-form">
                <label for="avatar" class="file-upload-label"
                    style="font-size: 0.9rem; color: var(--primary-color); display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-camera"></i> Change Photo
                </label>
                <input type="file" name="avatar" id="avatar" accept="image/*" onchange="this.form.submit()"
                    style="display: none;">
            </form>
        </div>
    </div>
</div>

<div class="profile-section">
    <h3>Change Password</h3>
    <form action="{{ url_for('auth.profile') }}" method="post" class="auth-form"
        style="max-width: 400px; margin-top: 1rem;">
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" name="current_password" placeholder="Current Password" required>
        </div>
        <div class="input-group">
            <i class="fas fa-key"></i>
            <input type="password" name="new_password" placeholder="New Password" required>
        </div>
        <button type="submit" class="btn-primary">Update Password</button>
    </form>
</div>

<div class="profile-section">
    <h3>Data Management</h3>
    <p style="color: var(--text-muted); margin: 0.5rem 0 1rem 0;">Download a copy of all your notes and tasks in JSON
        format.</p>
    <a href="{{ url_for('main.export_data') }}" class="btn-primary"
        style="display: inline-block; text-decoration: none;">
        <i class="fas fa-download"></i> Export Data
    </a>
</div>

{% with messages = get_flashed_messages() %}
{% if messages %}
<div class="flash-messages">
    {% for message in messages %}
    <div class="flash-message">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

{% endblock %}